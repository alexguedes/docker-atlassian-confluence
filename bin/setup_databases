#!/usr/bin/env bash

echo "Start PostgreSQL 9.3"
PID=$(docker run -d --name postgres -v /var/run postgres:9.3)

echo "Waiting for PostgreSQL to start"
docker logs -f "$PID" 2>&1 | grep --color --quiet 'PostgreSQL init process complete; ready for start up.'

echo "Creating Confluence database on PostgreSQL"
docker run --link "$PID":db postgres:9.3 psql --host db --user postgres --command "create database confluence owner postgres encoding 'utf8';"
